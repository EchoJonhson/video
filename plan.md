# FireRedASR ä¸­æ–‡è‡ªç„¶æ®µåˆ†æ®µåŠŸèƒ½å¼€å‘è®¡åˆ’ (å®ç”¨ç‰ˆ)

## ğŸ¯ é¡¹ç›®ç›®æ ‡

åŸºäºç°æœ‰æ¶æ„ï¼Œä¸º FireRedASR æ·»åŠ ä¸­æ–‡è‡ªç„¶æ®µåˆ†æ®µåŠŸèƒ½ï¼š

```
éŸ³é¢‘ â†’ åˆ‡ç‰‡ â†’ è½¬å†™ â†’ æ‹¼æ¥ â†’ [ç°æœ‰æ ‡ç‚¹æ¢å¤] â†’ [æ–°å¢åˆ†æ®µç®—æ³•] â†’ è‡ªç„¶æ®µè¾“å‡º
```

## ğŸ“‹ æŠ€æœ¯æ–¹æ¡ˆæ¦‚è§ˆ

### æ ¸å¿ƒæŠ€æœ¯æ ˆï¼ˆåŸºäºç°æœ‰åŸºç¡€ï¼‰
- **æ ‡ç‚¹æ¢å¤**: ç°æœ‰ `PunctuationRestorer` ç±»ï¼ˆå·²æ”¯æŒæ»‘åŠ¨çª—å£ã€æ‰¹å¤„ç†ï¼‰
- **åˆ†æ®µç®—æ³•**: å¤šç­–ç•¥èåˆï¼ˆè§„åˆ™+è¯­ä¹‰+ç»Ÿè®¡ï¼‰  
- **è¯­ä¹‰æ¨¡å‹**: æœ¬åœ°ä¸­æ–‡sentence-transformersæ¨¡å‹
- **å¤‡é€‰æ–¹æ¡ˆ**: çº¯è§„åˆ™ç®—æ³•ï¼ˆ100%ç¦»çº¿å¯ç”¨ï¼‰

### æ•´ä½“æ¶æ„
```mermaid
graph LR
    A[éŸ³é¢‘è¾“å…¥] --> B[VADåˆ‡ç‰‡] 
    B --> C[FireRedASRè½¬å†™]
    C --> D[æ–‡æœ¬æ‹¼æ¥]
    D --> E[ç°æœ‰æ ‡ç‚¹æ¢å¤]
    E --> F[æ–°å¢åˆ†æ®µæ¨¡å—]
    F --> G[å¤šæ ¼å¼è¾“å‡º]
```

## ğŸ—‚ï¸ å®ç”¨å¼€å‘æ¸…å•

### Phase 1: åˆ†æ®µç®—æ³•è®¾è®¡ä¸å®ç° (2å¤©)

#### 1.1 çº¯è§„åˆ™åˆ†æ®µç®—æ³• ğŸ“ (ä¼˜å…ˆçº§æœ€é«˜)
- [ ] **åˆ›å»º `fireredasr/utils/paragraph_segmentation.py`**
  - [ ] åŸºäºä¸­æ–‡æ ‡ç‚¹çš„æ®µè½è¾¹ç•Œæ£€æµ‹ï¼ˆã€‚ï¼ï¼Ÿï¼‰
  - [ ] è¯­è¨€ç‰¹å¾åˆ†æï¼ˆè¿è¯ã€ä»£è¯ã€æ—¶é—´æ ‡å¿—è¯ï¼‰
  - [ ] é•¿åº¦æ§åˆ¶ï¼ˆæœ€å°50å­—ï¼Œæœ€å¤§500å­—ï¼‰
  - [ ] è¯­ä¹‰è¿è´¯æ€§ç®€å•åˆ¤æ–­ï¼ˆé‡å¤è¯æ±‡ã€ä¸»é¢˜è¯ï¼‰

#### 1.2 è¯­ä¹‰å¢å¼ºåˆ†æ®µ ğŸ§  (ç½‘ç»œå…è®¸æ—¶)
- [ ] **å°è¯•è·å–sentence-transformersä¸­æ–‡æ¨¡å‹**
  - [ ] æ–¹æ³•1: HuggingFace `paraphrase-multilingual-MiniLM-L12-v2`
  - [ ] æ–¹æ³•2: å›½å†…é•œåƒæºä¸‹è½½
  - [ ] æ–¹æ³•3: ä½¿ç”¨ç°æœ‰embeddingæ¨¡å‹
  - [ ] **å¤‡é€‰**: ä½¿ç”¨jiebaåˆ†è¯+TF-IDFç›¸ä¼¼åº¦

#### 1.3 å¤–ç½‘ä¾èµ–å°è¯• ğŸŒ (å¯é€‰ï¼Œå¤±è´¥ä¸å½±å“è¿›åº¦)
- [ ] **å°è¯•è·å–ä¸“ä¸šåˆ†æ®µæ¨¡å‹ï¼ˆ1å°æ—¶é™æ—¶ï¼‰**
  - [ ] wtpsplit pipå®‰è£…æµ‹è¯•
  - [ ] ä»£ç†/é•œåƒæ–¹å¼å°è¯•
  - [ ] **å¤±è´¥åç«‹å³è½¬å‘å¤‡é€‰æ–¹æ¡ˆ**

### Phase 2: æ ¸å¿ƒåˆ†æ®µæ¨¡å—å¼€å‘ (2å¤©)

#### 2.1 åˆ†æ®µç®—æ³•æ ¸å¿ƒå®ç° ğŸ“‘
- [ ] **å®Œå–„ `fireredasr/utils/paragraph_segmentation.py`**
  ```python
  class ParagraphSegmenter:
      def __init__(self, method="hybrid", min_length=50, max_length=500):
          self.method = method  # rule/semantic/hybrid
          
      def segment_paragraphs(self, text_with_punctuation):
          # ä¸»è¦åˆ†æ®µå…¥å£
          
      def rule_based_segment(self, text):
          # çº¯è§„åˆ™åˆ†æ®µï¼ˆ100%å¯ç”¨ï¼‰
          
      def semantic_segment(self, text):
          # è¯­ä¹‰åˆ†æ®µï¼ˆéœ€è¦æ¨¡å‹ï¼‰
          
      def hybrid_segment(self, text):
          # æ··åˆç­–ç•¥ï¼ˆæ¨èï¼‰
  ```

#### 2.2 å¤šç­–ç•¥åˆ†æ®µç®—æ³• ğŸ¯
- [ ] **è§„åˆ™åˆ†æ®µç®—æ³•**
  - [ ] å¼ºå¥ç»“å°¾æ£€æµ‹ï¼ˆã€‚ï¼ï¼Ÿ...ï¼‰
  - [ ] å¼±åˆ†ç•Œæ£€æµ‹ï¼ˆï¼Œï¼›ï¼š""ï¼‰  
  - [ ] è¯é¢˜è½¬æ¢è¯è¯†åˆ«ï¼ˆ"å¦å¤–"ã€"ç„¶å"ã€"æ¥ä¸‹æ¥"ï¼‰
  - [ ] é•¿åº¦çº¦æŸå’Œå¹³è¡¡å¤„ç†

- [ ] **è¯­ä¹‰åˆ†æ®µç®—æ³•ï¼ˆå¯é€‰ï¼‰**
  - [ ] å¥å­å‘é‡åŒ–ï¼ˆä¼˜å…ˆæœ¬åœ°æ¨¡å‹ï¼‰
  - [ ] ç›¸é‚»å¥å­ç›¸ä¼¼åº¦è®¡ç®—
  - [ ] ç›¸ä¼¼åº¦é˜ˆå€¼åˆ†æ®µ
  - [ ] **å®Œå…¨å¤±è´¥æ—¶å›é€€åˆ°è§„åˆ™ç®—æ³•**

#### 2.3 æ–‡æœ¬å¤„ç†ç®¡é“ä¼˜åŒ– ğŸ”„
- [ ] **åŸºäºç°æœ‰æ¶æ„æ‰©å±•**
  - [ ] ç›´æ¥ä¿®æ”¹ `long_audio_transcribe.py` çš„æ‹¼æ¥é€»è¾‘
  - [ ] åœ¨ç°æœ‰æ ‡ç‚¹æ¢å¤åæ·»åŠ åˆ†æ®µæ­¥éª¤
  - [ ] ä¿æŒå‘åå…¼å®¹ï¼ˆé»˜è®¤å…³é—­åˆ†æ®µï¼‰

### Phase 3: é›†æˆç°æœ‰è½¬å†™å·¥å…· (1å¤©)

#### 3.1 å‡çº§é•¿éŸ³é¢‘è½¬å†™ ğŸ¬
- [ ] **ä¿®æ”¹ `long_audio_transcribe.py`**
  - [ ] åœ¨ç¬¬29è¡Œå¯¼å…¥åæ·»åŠ åˆ†æ®µæ¨¡å—
  - [ ] åœ¨æ‹¼æ¥æ–¹æ³•ä¸­æ·»åŠ åˆ†æ®µé€‰é¡¹
  - [ ] æ–°å¢å‘½ä»¤è¡Œå‚æ•°ï¼š
    ```bash
    --enable-paragraph         # å¯ç”¨åˆ†æ®µ
    --paragraph-method hybrid  # rule/semantic/hybrid  
    --min-paragraph-length 50  # æœ€å°æ®µè½é•¿åº¦
    ```
  - [ ] è¾“å‡ºæ–‡ä»¶æ–°å¢ï¼š`*_paragraphs.txt`

#### 3.2 å‡çº§é•¿è§†é¢‘è½¬å†™ ğŸ“¹
- [ ] **åŒæ­¥ä¿®æ”¹ `long_video_transcribe.py`**
  - [ ] å¤åˆ¶éŸ³é¢‘è½¬å†™çš„åˆ†æ®µé€»è¾‘
  - [ ] ä¿æŒæ¥å£ä¸€è‡´æ€§

#### 3.3 æ‰¹é‡å¤„ç†å·¥å…·é€‚é… ğŸ“¦  
- [ ] **ä¿®æ”¹ `batch_transcribe.py`**
  - [ ] ä¼ é€’åˆ†æ®µå‚æ•°åˆ°å•ä¸ªè½¬å†™ä»»åŠ¡
  - [ ] æ‰¹é‡ç”Ÿæˆæ®µè½æ ¼å¼è¾“å‡º

### Phase 4: æµ‹è¯•å’Œæ–‡æ¡£ (1å¤©)

#### 4.1 åŠŸèƒ½æµ‹è¯• ğŸ§ª
- [ ] **åˆ›å»ºæµ‹è¯•è„šæœ¬**
  - [ ] ä½¿ç”¨ `examples/wav/` ä¸­çš„éŸ³é¢‘æµ‹è¯•
  - [ ] å¯¹æ¯”åŸå§‹è½¬å†™ vs åˆ†æ®µæ•ˆæœ
  - [ ] æµ‹è¯•ä¸åŒåˆ†æ®µæ–¹æ³•çš„æ•ˆæœ
  - [ ] éªŒè¯è¾“å‡ºæ ¼å¼æ­£ç¡®æ€§

#### 4.2 æ€§èƒ½éªŒè¯ âš¡
- [ ] **å¤„ç†æ—¶é—´æµ‹è¯•**
  - [ ] è§„åˆ™ç®—æ³•vsè¯­ä¹‰ç®—æ³•é€Ÿåº¦å¯¹æ¯”
  - [ ] å†…å­˜å ç”¨ç›‘æ§
  - [ ] å¤§æ–‡ä»¶å¤„ç†ç¨³å®šæ€§æµ‹è¯•

## ğŸ”§ å¤–ç½‘ä¾èµ–å¤±è´¥æ—¶çš„å¤‡é€‰æ–¹æ¡ˆ

### æ ‡ç‚¹æ¢å¤å¤‡é€‰ç­–ç•¥
å½“ç°æœ‰ `PunctuationRestorer` çš„ HuggingFace æ¨¡å‹æ— æ³•ä¸‹è½½æ—¶ï¼š

#### ç­–ç•¥A: è½»é‡çº§è§„åˆ™æ¨¡å‹ 
```python
class SimplePunctuationRestorer:
    def restore_punctuation(self, text):
        # åŸºäºè¯é¢‘ã€åœé¡¿æ—¶é•¿ã€è¯­éŸ³ç‰¹å¾çš„è§„åˆ™
        # å¥æœ«è¯æ±‡æ£€æµ‹ï¼ˆ"çš„"ã€"äº†"ã€"å•Š"ï¼‰
        # ç–‘é—®è¯æ£€æµ‹ï¼ˆ"ä»€ä¹ˆ"ã€"æ€ä¹ˆ"ã€"ä¸ºä»€ä¹ˆ"ï¼‰
        # è¯­è°ƒè¯æ£€æµ‹ï¼ˆ"å“"ã€"å—¯"ã€"å‘ƒ"ï¼‰
```

#### ç­–ç•¥B: ç»Ÿè®¡å­¦æ–¹æ³•
- åŸºäºå¤§é‡ä¸­æ–‡æ–‡æœ¬çš„æ ‡ç‚¹ä½¿ç”¨ç»Ÿè®¡
- N-gramæ¨¡å‹é¢„æµ‹æ ‡ç‚¹ä½ç½®
- æ— éœ€æ·±åº¦å­¦ä¹ æ¨¡å‹

### è¯­ä¹‰åˆ†æ®µå¤‡é€‰ç­–ç•¥

#### ç­–ç•¥A: çº¯è§„åˆ™åˆ†æ®µï¼ˆ100%å¯ç”¨ï¼‰
```python  
def rule_based_segment(text):
    # 1. å¼ºåˆ†ç•Œç‚¹ï¼šã€‚ï¼ï¼Ÿ
    # 2. å¼±åˆ†ç•Œç‚¹ï¼šï¼Œï¼›ï¼š
    # 3. è¯é¢˜è½¬æ¢è¯ï¼š"å¦å¤–"ã€"ç„¶å"ã€"æ¥ä¸‹æ¥"ã€"é¦–å…ˆ"
    # 4. æ—¶é—´æ ‡å¿—ï¼š"ä»Šå¤©"ã€"æ˜¨å¤©"ã€"æ¥ä¸‹æ¥"
    # 5. é•¿åº¦å¹³è¡¡ï¼šé¿å…è¿‡é•¿/è¿‡çŸ­æ®µè½
```

#### ç­–ç•¥B: åŸºäºjiebaçš„ç®€å•è¯­ä¹‰
```python
def simple_semantic_segment(text):
    # ä½¿ç”¨jiebaåˆ†è¯ + TF-IDFè®¡ç®—å¥å­ç›¸ä¼¼åº¦
    # è¯æ±‡é‡å åº¦åˆ†æ
    # ä¸»é¢˜è¯å»¶ç»­æ€§åˆ¤æ–­
```

#### ç­–ç•¥C: æ··åˆç­–ç•¥ï¼ˆæ¨èï¼‰
- 70%è§„åˆ™ + 30%ç®€å•è¯­ä¹‰
- å³ä½¿è¯­ä¹‰éƒ¨åˆ†å¤±è´¥ï¼Œè§„åˆ™éƒ¨åˆ†ä¿è¯åŸºæœ¬å¯ç”¨

## ğŸ”§ å®é™…å¯è¡Œçš„æŠ€æœ¯å®ç°

### åŸºäºç°æœ‰æ ‡ç‚¹æ¢å¤æ¨¡å—
```python
# ç›´æ¥ä½¿ç”¨ç°æœ‰çš„ fireredasr/utils/punctuation_restore.py
from fireredasr.utils.punctuation_restore import PunctuationRestorer

def process_with_existing_punctuation(text):
    restorer = PunctuationRestorer()
    return restorer.restore_punctuation(text)
    # å·²æ”¯æŒæ»‘åŠ¨çª—å£ã€æ‰¹å¤„ç†ã€GPUè‡ªé€‚åº”
```

### å®ç”¨åˆ†æ®µç®—æ³•å®ç°
```python
import re
import jieba
from collections import Counter

class PragmaticParagraphSegmenter:
    def __init__(self, method="hybrid", min_length=50, max_length=500):
        self.method = method
        self.min_length = min_length  
        self.max_length = max_length
        
        # è¯é¢˜è½¬æ¢è¯åº“
        self.transition_words = {
            "å¦å¤–", "ç„¶å", "æ¥ä¸‹æ¥", "é¦–å…ˆ", "å…¶æ¬¡", "æœ€å", 
            "åŒæ—¶", "æ­¤å¤–", "ä¸è¿‡", "ä½†æ˜¯", "ç„¶è€Œ", "æ€»ä¹‹"
        }
    
    def rule_based_segment(self, text):
        # çº¯è§„åˆ™åˆ†æ®µ - 100%å¯ç”¨
        sentences = re.split(r'[ã€‚ï¼ï¼Ÿ]', text)
        paragraphs = []
        current_para = ""
        
        for sentence in sentences:
            if not sentence.strip():
                continue
                
            # æ£€æŸ¥è¯é¢˜è½¬æ¢è¯
            has_transition = any(word in sentence for word in self.transition_words)
            
            # é•¿åº¦æ§åˆ¶å’Œè¯é¢˜åˆ¤æ–­
            if (len(current_para) > self.min_length and 
                (has_transition or len(current_para) > self.max_length)):
                paragraphs.append(current_para.strip())
                current_para = sentence
            else:
                current_para += sentence + "ã€‚"
        
        if current_para.strip():
            paragraphs.append(current_para.strip())
            
        return paragraphs
    
    def simple_semantic_segment(self, text):
        # åŸºäºjiebaçš„ç®€å•è¯­ä¹‰ - éœ€è¦jieba
        try:
            sentences = re.split(r'[ã€‚ï¼ï¼Ÿ]', text)
            # ä½¿ç”¨è¯æ±‡é‡å åº¦å’ŒTF-IDFç›¸ä¼¼åº¦
            # å¤±è´¥æ—¶è‡ªåŠ¨å›é€€åˆ°è§„åˆ™ç®—æ³•
            return self._calculate_semantic_boundaries(sentences)
        except:
            return self.rule_based_segment(text)
```

## ğŸ“ æœ€å°åŒ–æ–‡ä»¶å˜æ›´

```
FireRedASR/
â”œâ”€â”€ fireredasr/utils/
â”‚   â”œâ”€â”€ punctuation_restore.py          # ä¿æŒä¸å˜ï¼ˆå·²å®Œå–„ï¼‰
â”‚   â””â”€â”€ paragraph_segmentation.py       # æ–°å¢ï¼šå”¯ä¸€æ–°æ–‡ä»¶
â”œâ”€â”€ long_audio_transcribe.py            # å°å¹…ä¿®æ”¹ï¼šæ·»åŠ åˆ†æ®µé€‰é¡¹
â”œâ”€â”€ long_video_transcribe.py            # å°å¹…ä¿®æ”¹ï¼šåŒæ­¥éŸ³é¢‘ç‰ˆæœ¬  
â”œâ”€â”€ batch_transcribe.py                 # å°å¹…ä¿®æ”¹ï¼šä¼ é€’åˆ†æ®µå‚æ•°
â””â”€â”€ requirements.txt                    # å¯é€‰æ·»åŠ ï¼šjiebaï¼ˆå¦‚æœéœ€è¦è¯­ä¹‰åˆ†æ®µï¼‰
```

## ğŸ“Š å¼€å‘æ—¶é—´é‡æ–°è¯„ä¼°

- **æ€»è€—æ—¶ï¼š6å¤©** (vs åŸè®¡åˆ’12å¤©)
- **é£é™©é™ä½ï¼š85%** (åŸºäºç°æœ‰åŠŸèƒ½ï¼Œæ— å¤–ç½‘ä¾èµ–)
- **å¯ç”¨æ€§ï¼š100%** (è§„åˆ™ç®—æ³•ä¿åº•)

## ğŸš€ ç«‹å³å¯è¡Œçš„ç¬¬ä¸€æ­¥

1. **åˆ›å»º `paragraph_segmentation.py`** - 2å°æ—¶
2. **ä¿®æ”¹ `long_audio_transcribe.py`** - 1å°æ—¶  
3. **æµ‹è¯•åŸºæœ¬åŠŸèƒ½** - 30åˆ†é’Ÿ

**ä»Šå¤©å°±èƒ½çœ‹åˆ°æ•ˆæœï¼**

## ğŸ¯ é‡è¦æé†’

### âŒ åŸè®¡åˆ’çš„ä¸»è¦é—®é¢˜ï¼š
1. **è¿‡åº¦ä¾èµ–å¤–ç½‘èµ„æº** - åœ¨å›½å†…ç¯å¢ƒåŸºæœ¬æ— æ³•å®ç°
2. **é‡å¤é€ è½®å­** - å¿½ç•¥äº†ç°æœ‰çš„å®Œå–„æ ‡ç‚¹æ¢å¤åŠŸèƒ½  
3. **æ—¶é—´ä¼°ç®—è¿‡äºä¹è§‚** - 12å¤©è®¡åˆ’å®é™…éœ€è¦æ›´å¤šæ—¶é—´è§£å†³ç½‘ç»œé—®é¢˜

### âœ… æ–°è®¡åˆ’çš„ä¼˜åŠ¿ï¼š
1. **é›¶å¤–ç½‘ä¾èµ–** - åŸºäºç°æœ‰åŠŸèƒ½å’Œè§„åˆ™ç®—æ³•
2. **å¿«é€Ÿè§æ•ˆ** - 3.5å°æ—¶å°±èƒ½çœ‹åˆ°åŸºæœ¬æ•ˆæœ
3. **é«˜å®¹é”™æ€§** - å³ä½¿è¯­ä¹‰ç®—æ³•å¤±è´¥ï¼Œè§„åˆ™ç®—æ³•ä¿åº•
4. **å‘åå…¼å®¹** - ä¸å½±å“ç°æœ‰ç”¨æˆ·ä½¿ç”¨

## ğŸ“Š æœ€ç»ˆå»ºè®®

è¿™ä¸ªé‡å†™çš„è®¡åˆ’æ›´å®é™…ã€å¯è¡Œã€å®‰å…¨ã€‚å…³é”®æ˜¯ï¼š

1. **å…ˆåšèƒ½åšçš„** - è§„åˆ™åˆ†æ®µç®—æ³•100%å¯ç”¨
2. **å†åšæƒ³åšçš„** - è¯­ä¹‰åˆ†æ®µä½œä¸ºå¢å¼ºåŠŸèƒ½
3. **åˆ«åšä¸å¯æ§çš„** - é¿å…ç½‘ç»œä¾èµ–

ä½ ç°åœ¨çš„é€‰æ‹©ï¼š
- **A**: æŒ‰æ–°è®¡åˆ’æ‰§è¡Œï¼Œ3.5å°æ—¶çœ‹åˆ°æ•ˆæœ
- **B**: åšæŒåŸè®¡åˆ’ï¼Œå¯èƒ½å¡åœ¨ä¾èµ–ä¸‹è½½ä¸Š
- **C**: å…ˆæµ‹è¯•ç½‘ç»œç¯å¢ƒï¼Œå†å†³å®šä½¿ç”¨å“ªä¸ªè®¡åˆ’

æˆ‘å¼ºçƒˆå»ºè®®é€‰æ‹©Aã€‚ä¸€ä¸ªèƒ½ç”¨çš„70åˆ†åŠŸèƒ½æ¯”ä¸€ä¸ªå®Œç¾ä½†ç”¨ä¸äº†çš„100åˆ†åŠŸèƒ½å¼ºæ— æ•°å€ã€‚